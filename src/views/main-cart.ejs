<!doctype html>
<html lang="ko">
    <head>
        <%- include('../views/partials/head'); %>
        <link rel="stylesheet" href="/css/header.css" />
        <link rel="stylesheet" href="/css/main-cart.css" />
        <link rel="stylesheet" href="/css/footer.css" />
    </head>

    <body class="container">
        <header class="header"><%- include('../views/partials/header'); %></header>

        <main role="main" class="contents">
            <div class="contents-inner">
                <!-- 장바구니 있을 때 -->
                <div class="main-cart-wrap">
                    <div class="main-cart">
                        <div class="utils">
                            <button type="button" class="btn btn-delete-opt">전체 삭제</button>
                        </div>
                        <ul class="cart-list" id="cartBox"></ul>
                    </div>

                    <div class="price-info">
                        <div class="box sticky">
                            <dl>
                                <div class="row">
                                    <dt>총 상품 금액</dt>
                                    <dd>3760000<span class="unit">원</span></dd>
                                </div>
                                <div class="row total">
                                    <dt>결제 금액</dt>
                                    <dd>3760000<span class="unit">원</span></dd>
                                </div>
                            </dl>
                            <div class="btn-box">
                                <a href="/order" class="btn btn-main"
                                    ><span>1</span>개의 상품구매하러가기</a
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <!--// 장바구니 있을 때 -->

                <!-- 장바구니 없을 때 -->
                <div class="no-cart" style="display: none">
                    <div class="icon">
                        <img src="/image/empty-icon.png" alt="장바구니없음" />
                    </div>
                    <a href="/" class="btn btn-main">상품 담으러 가기</a>
                </div>

                <!--// 장바구니 없을 때 -->
            </div>
        </main>
        <footer class="footer"><%- include('../views/partials/footer'); %></footer>
        <script>
            function getItem(item) {
                const data = localStorage.getItem(item);
                if (data === null) {
                    return {};
                }
                return JSON.parse(data);
            }

            let cart = getItem('cart');
            console.log(cart.length);

            window.addEventListener('load', (event) => {
                if (cart.length) {
                    const noCartElem = document.querySelector('.no-cart');
                    // console.log('1' + noCartElem);
                    noCartElem.style.display = 'none';
                    return;
                }
            });

            window.addEventListener('load', (event) => {
                if (cart.length) {
                    let str = '';
                    cart.forEach((item, index) => {
                        const productNam = item.productName;
                        const price = item.price;
                        const image = item.image;
                        const quantity = item.quantity;
                        console.log(productNam);

                        str += `<li class="cart-list-li">
                            
                                <div class="item-info">
                                
                                    <div class="info">
                                        <p class="name">${productNam}</p>
                                        <p class="delivery">무료배송</p>
                                    </div>
                                </div>
                                <div class="item-option">
                                    <p>단품 구매</p>

                                    <div class="option-quantity">
                                        <div class="quantity">
                                            <button type="button" class="btn btn-minus">-</button>
                                            <span class="count">${quantity}</span>
                                            <button type="button" class="btn btn-plus">+</button>
                                        </div>
                                        <div class="total">${price}<span class="unit">원</span></div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-item-delete"></button>
                            </li>`;
                    });

                    var cartBox = document.getElementById('cartBox');
                    cartBox.insertAdjacentHTML('beforeend', str);

                    document.querySelectorAll('.btn-item-delete').forEach((btn) => {
                        btn.addEventListener('click', (event) => {
                            const itemName =
                                event.target.parentElement.querySelector('.name').textContent;

                            for (let i = 0; i < cart.length; i++) {
                                if (cart[i].productName === itemName) {
                                    cart.splice(i, 1);
                                    break;
                                }
                            }

                            event.target.parentElement.remove();

                            localStorage.setItem('cart', JSON.stringify(cart));
                        });
                    });

                    let minus = document.querySelectorAll('.btn btn-minus');
                    let plus = document.querySelectorAll('.btn btn-plus');
                } else {
                    const noResult = document.querySelector('.no-cart');
                    noResult.style.display = 'flex';
                }
            });
        </script>
    </body>
</html>
